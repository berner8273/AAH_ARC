CREATE OR REPLACE FORCE VIEW RDR.RRV_AG_GLINT_PS_JOURNALS
(
   RGJL_ID,
   RGJL_RGJ_ID,
   RGJL_RGJ_RGBC_ID,
   RGJL_AAH_JOURNAL,
   RGJL_AAH_JOURNAL_LINE,
   INPUT_TIME,
   INPUT_USER,
   MODIFIED_TIME,
   MODIFIED_USER,
   GL_DISTRIB_STATUS,
   APPL_JRNL_ID,
   BUSINESS_UNIT_GL,
   BUSINESS_UNIT,
   LEDGER_GROUP,
   LEDGER,
   JOURNAL_ID,
   JOURNAL_DATE,
   JOURNAL_LINE,
   ACCOUNTING_DT,
   FISCAL_YEAR,
   ACCOUNTING_PERIOD,
   FOREIGN_CURRENCY,
   FOREIGN_AMOUNT,
   CURRENCY_CD,
   MONETARY_AMOUNT,
   ACCOUNT,
   DEPTID,
   PRODUCT,
   AFFILIATE,
   PROGRAM_CODE,
   CHARTFIELD1,
   LINE_DESCR,
   JRNL_LN_REF,
   PROCESS_INSTANCE,
   NOTES_254,
   DTTM_STAMP,
   EVENT_CLASS,
   AAH_JRNL_HDR_NBR,
   CREDIT_AMT,
   DEBIT_AMT,
   EVENT_STATUS,
   SLR_PROCESS_ID,
   MANUAL_JE,
   PS_FILTER,
   JL_JRNL_HDR_ID,
   JL_JRNL_LINE_NUMBER,
   JL_FAK_ID,
   JL_EBA_ID,
   JL_JRNL_STATUS,
   JL_JRNL_STATUS_TEXT,
   JL_JRNL_PROCESS_ID,
   JL_DESCRIPTION,
   JL_SOURCE_JRNL_ID,
   JL_EFFECTIVE_DATE,
   JL_VALUE_DATE,
   JL_ENTITY,
   JL_EPG_ID,
   JL_ACCOUNT,
   JL_SEGMENT_1,
   JL_SEGMENT_2,
   JL_SEGMENT_3,
   JL_SEGMENT_4,
   JL_SEGMENT_5,
   JL_SEGMENT_6,
   JL_SEGMENT_7,
   JL_SEGMENT_8,
   JL_SEGMENT_9,
   JL_SEGMENT_10,
   JL_ATTRIBUTE_1,
   JL_ATTRIBUTE_2,
   JL_ATTRIBUTE_3,
   JL_ATTRIBUTE_4,
   JL_ATTRIBUTE_5,
   JL_REFERENCE_1,
   JL_REFERENCE_2,
   JL_REFERENCE_3,
   JL_REFERENCE_4,
   JL_REFERENCE_5,
   JL_REFERENCE_6,
   JL_REFERENCE_7,
   JL_REFERENCE_8,
   JL_REFERENCE_9,
   JL_REFERENCE_10,
   JL_TRAN_CCY,
   JL_TRAN_AMOUNT,
   JL_BASE_RATE,
   JL_BASE_CCY,
   JL_BASE_AMOUNT,
   JL_LOCAL_RATE,
   JL_LOCAL_CCY,
   JL_LOCAL_AMOUNT,
   JL_CREATED_BY,
   JL_CREATED_ON,
   JL_AMENDED_BY,
   JL_AMENDED_ON,
   JL_RECON_STATUS,
   JL_TRANSLATION_DATE,
   JL_BUS_POSTING_DATE,
   JL_PERIOD_MONTH,
   JL_PERIOD_YEAR,
   JL_PERIOD_LTD,
   JL_TYPE
)
   BEQUEATH DEFINER
AS
   SELECT GJL.RGJL_ID,
          GJL.RGJL_RGJ_ID,
          GJL.RGJL_RGJ_RGBC_ID,
          GJL.RGJL_AAH_JOURNAL,
          GJL.RGJL_AAH_JOURNAL_LINE,
          GJL.INPUT_TIME,
          GJL.INPUT_USER,
          GJL.MODIFIED_TIME,
          GJL.MODIFIED_USER,
          GJL.GL_DISTRIB_STATUS,
          GJL.APPL_JRNL_ID,
          GJL.BUSINESS_UNIT_GL,
          GJL.BUSINESS_UNIT,
          GJL.LEDGER_GROUP,
          GJL.LEDGER,
          GJL.JOURNAL_ID,
          GJL.JOURNAL_DATE,
          GJL.JOURNAL_LINE,
          GJL.ACCOUNTING_DT,
          GJL.FISCAL_YEAR,
          GJL.ACCOUNTING_PERIOD,
          GJL.FOREIGN_CURRENCY,
          GJL.FOREIGN_AMOUNT,
          GJL.CURRENCY_CD,
          GJL.MONETARY_AMOUNT,
          GJL.ACCOUNT,
          GJL.DEPTID,
          GJL.PRODUCT,
          GJL.AFFILIATE,
          GJL.PROGRAM_CODE,
          GJL.CHARTFIELD1,
          GJL.LINE_DESCR,
          GJL.JRNL_LN_REF,
          GJL.PROCESS_INSTANCE,
          GJL.NOTES_254,
          GJL.DTTM_STAMP,
          GJL.EVENT_CLASS,
          GJL.AAH_JRNL_HDR_NBR,
          GJL.CREDIT_AMT,
          GJL.DEBIT_AMT,
          GJL.EVENT_STATUS,
          GJL.SLR_PROCESS_ID,
          GJL.MANUAL_JE,
          GJL.PS_FILTER,
          SJL.JL_JRNL_HDR_ID,
          SJL.JL_JRNL_LINE_NUMBER,
          SJL.JL_FAK_ID,
          SJL.JL_EBA_ID,
          SJL.JL_JRNL_STATUS,
          SJL.JL_JRNL_STATUS_TEXT,
          SJL.JL_JRNL_PROCESS_ID,
          SJL.JL_DESCRIPTION,
          SJL.JL_SOURCE_JRNL_ID,
          SJL.JL_EFFECTIVE_DATE,
          SJL.JL_VALUE_DATE,
          SJL.JL_ENTITY,
          SJL.JL_EPG_ID,
          SJL.JL_ACCOUNT,
          SJL.JL_SEGMENT_1,
          SJL.JL_SEGMENT_2,
          SJL.JL_SEGMENT_3,
          SJL.JL_SEGMENT_4,
          SJL.JL_SEGMENT_5,
          SJL.JL_SEGMENT_6,
          SJL.JL_SEGMENT_7,
          SJL.JL_SEGMENT_8,
          SJL.JL_SEGMENT_9,
          SJL.JL_SEGMENT_10,
          SJL.JL_ATTRIBUTE_1,
          SJL.JL_ATTRIBUTE_2,
          SJL.JL_ATTRIBUTE_3,
          SJL.JL_ATTRIBUTE_4,
          SJL.JL_ATTRIBUTE_5,
          SJL.JL_REFERENCE_1,
          SJL.JL_REFERENCE_2,
          SJL.JL_REFERENCE_3,
          SJL.JL_REFERENCE_4,
          SJL.JL_REFERENCE_5,
          SJL.JL_REFERENCE_6,
          SJL.JL_REFERENCE_7,
          SJL.JL_REFERENCE_8,
          SJL.JL_REFERENCE_9,
          SJL.JL_REFERENCE_10,
          SJL.JL_TRAN_CCY,
          SJL.JL_TRAN_AMOUNT,
          SJL.JL_BASE_RATE,
          SJL.JL_BASE_CCY,
          SJL.JL_BASE_AMOUNT,
          SJL.JL_LOCAL_RATE,
          SJL.JL_LOCAL_CCY,
          SJL.JL_LOCAL_AMOUNT,
          SJL.JL_CREATED_BY,
          SJL.JL_CREATED_ON,
          SJL.JL_AMENDED_BY,
          SJL.JL_AMENDED_ON,
          SJL.JL_RECON_STATUS,
          SJL.JL_TRANSLATION_DATE,
          SJL.JL_BUS_POSTING_DATE,
          SJL.JL_PERIOD_MONTH,
          SJL.JL_PERIOD_YEAR,
          SJL.JL_PERIOD_LTD,
          SJL.JL_TYPE
     FROM RDR.RR_GLINT_JOURNAL_LINE GJL
          JOIN SLR.SLR_JRNL_LINES SJL
             ON     SJL.JL_EFFECTIVE_DATE = GJL.ACCOUNTING_DT
                AND SJL.JL_TRAN_CCY = GJL.FOREIGN_CURRENCY
                AND SJL.JL_BASE_CCY = GJL.CURRENCY_CD
                AND SUBSTR (SJL.JL_ACCOUNT, 1, 8) = GJL.ACCOUNT
                AND (CASE
                        WHEN SJL.JL_SEGMENT_3 = 'NVS' THEN ' '
                        ELSE SJL.JL_SEGMENT_3
                     END) = GJL.DEPTID
                AND (CASE
                        WHEN SJL.JL_SEGMENT_5 = 'NVS' THEN ' '
                        ELSE SUBSTR (SJL.JL_SEGMENT_5, 1, 10)
                     END) = GJL.CHARTFIELD1
                AND (CASE
                        WHEN SJL.JL_SEGMENT_4 = 'NVS' THEN ' '
                        ELSE SJL.JL_SEGMENT_4
                     END) = GJL.AFFILIATE
                AND SJL.JL_ENTITY = GJL.BUSINESS_UNIT_GL
                AND SJL.JL_JRNL_PROCESS_ID = GJL.SLR_PROCESS_ID
                AND SJL.JL_SEGMENT_1 = GJL.LEDGER_GROUP
                AND (   (    GJL.MANUAL_JE = 'Y'
                         AND SJL.JL_JRNL_HDR_ID = GJL.AAH_JRNL_HDR_NBR)
                     OR (GJL.MANUAL_JE = 'N' AND GJL.AAH_JRNL_HDR_NBR = 0))
          JOIN FDR.FR_GENERAL_LOOKUP FGL
             ON     SJL.JL_ATTRIBUTE_4 = FGL.LK_MATCH_KEY1
                AND FGL.LK_LKT_LOOKUP_TYPE_CODE = 'EVENT_HIERARCHY'
                AND GJL.EVENT_CLASS = FGL.LK_LOOKUP_VALUE3
    WHERE 1 = 1;

COMMENT ON TABLE RDR.RRV_AG_GLINT_PS_JOURNALS IS 'View that ties PS Journals to GLINT to SLR';
